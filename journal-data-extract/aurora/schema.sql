-- MySQL equivalent of Oracle TARS Journal tables
--
-- Oracle to MySQL data type mapping rules as follows:
-- VARCHAR2(n) => VARCHAR(n)
-- DATE => DATETIME
-- NUMBER(1..2) => TINYINT
-- NUMBER(3..4) => SMALLINT
-- NUMBER(5..8) => INT
-- NUMBER(9..18) => BIGINT
-- NUMBER(n, m) if m > 0 => DECIMAL(n,m)
-- check constraints are ignored by MySQL (have to use triggers)
-- foreign keys dropped to allow DMS

CREATE TABLE EXAMINER
(	STAFF_NUMBER VARCHAR(10) NOT NULL,
	GRADE_CODE VARCHAR(4),
	PROB_PER_START_DATE DATETIME,
	PROB_PER_END_DATE DATETIME,
	DSA_BIKE_IND TINYINT,
	DSA_RADIO_IND TINYINT,
	WELSH_SPKG_CODE TINYINT DEFAULT 1 NOT NULL,
	DEPLOY_IND INT,
	NON_DEPLOY_TEXT VARCHAR(255),
	SKILL_TEXT VARCHAR(400),
	MAN_PROG_START_DATE DATETIME,
	MAN_PROG_END_DATE DATETIME,
	UPDATED_ON DATETIME NOT NULL,
	CREATED_ON DATETIME NOT NULL,
	UPDATED_BY BIGINT NOT NULL,
	CREATED_BY BIGINT NOT NULL,
	INDIVIDUAL_ID BIGINT NOT NULL,
	MOBILE_IND TINYINT DEFAULT 0 NOT NULL,
	EMAIL_JOURNALS_IND TINYINT DEFAULT 0 NOT NULL,
	DVSA_EMAIL VARCHAR(100),
	STOP_JOURNALS_IND TINYINT,
	CONSTRAINT EXAM_IND_ID_PK PRIMARY KEY (INDIVIDUAL_ID),
	CONSTRAINT EXAM_STAFF_NO_UQ UNIQUE (STAFF_NUMBER)
);

CREATE TABLE INDIVIDUAL
(	INDIVIDUAL_ID BIGINT,
  DRIVER_NUMBER VARCHAR(24),
  DATE_OF_BIRTH DATETIME,
  TEST_CENTRE_ID INT,
  TITLE_CODE BIGINT,
  PREVIOUS_TEST_CENTRE_ID INT,
  FAMILY_NAME VARCHAR(50),
  FIRST_FORENAME VARCHAR(50),
  SECOND_FORENAME VARCHAR(50),
  THIRD_FORENAME VARCHAR(50),
  PERSON_INITIALS VARCHAR(8),
  PERSON_FULL_NAME VARCHAR(100),
  PERSON_REQUESTED_NAME VARCHAR(50),
  VAT_REGISTERED TINYINT,
  DEFAULT_ADDRESS_CODE BIGINT,
  GENDER_CODE BIGINT,
  TOTAL_POINTS DECIMAL(8,2),
  DATE_OF_FIRST_LICENCE DATETIME,
  LICENCE_EXPIRY_DATE DATETIME,
  LAST_UPDATED_BY_DVLA DATETIME,
  PP_STATUS_CODE BIGINT,
  PP_DATE_FIRST_ISSUED DATETIME,
  PP_CERTS_ISSUED INT,
  PP_PACKS_ORDERED INT,
  PP_DESPATCH_ADD VARCHAR(20),
  PP_CONSENT_MARKER INT,
  PP_STARTER_FEE_PAID DECIMAL(8,2),
  BAD_DEBT_IND TINYINT,
  EXTERNAL_MAIL_CONSENT_IND TINYINT,
  ID_CONFIRMATION_STATUS_CODE BIGINT,
  IS_ORGAN_DONOR TINYINT,
  IS_TITLE_ADDRESS TINYINT,
  DISABLED_MARKER TINYINT,
  DATE_OF_BIRTH_VERIFIED_CODE VARCHAR(10),
  DATE_OF_DEATH DATETIME,
  NOTIFIED_DECEASED_CODE BIGINT,
  DATE_ENTERED DATETIME,
  DATE_MOVED DATETIME,
  COUNTRY_OF_BIRTH VARCHAR(50),
  COUNTRY_OF_BIRTH_INTERNAL_CODE BIGINT,
  NATIONALITY_CODE BIGINT,
  PREFERRED_LANGUAGE_CODE BIGINT,
  REASON_CODE BIGINT,
  STATE_CODE BIGINT,
  COMMUNICATION_PREF_CODE BIGINT,
  NOTES VARCHAR(255),
  CREATED_BY BIGINT NOT NULL,
  CREATED_ON DATETIME NOT NULL,
  UPDATED_BY BIGINT NOT NULL,
  UPDATED_ON DATETIME NOT NULL,
  INCREASE_FEE_IND TINYINT,
  BOOKING_REVIEW_IND TINYINT,
  INTEGRITY_IND TINYINT,
  NO_MAILINGS TINYINT,
  WEB_IND_CODE BIGINT,
  ETHNIC_ORIGIN_CODE BIGINT,
  EU_LICENCE_IND TINYINT,
  DVLA_PHOTO_AUTH TINYINT,
  SC_PUBLISH_IND TINYINT,
	CONSTRAINT INDV_INDVID_PK PRIMARY KEY (INDIVIDUAL_ID)
);

CREATE TABLE REF_DATA_ITEM_MASTER
(	 ITEM_ID BIGINT,
   ITEM_DESC1 VARCHAR(255),
   ITEM_DESC2 VARCHAR(255),
   EXT_DESC VARCHAR(255),
   CATEGORY_ID BIGINT,
   VALID_FROM_DATE DATETIME,
   VALID_TO_DATE DATETIME,
   PARENT_ITEM_ID BIGINT,
   SORTING_ORDER DECIMAL(38) DEFAULT 0,
   ACTIVE_FLG VARCHAR(1),
   CREATED_BY BIGINT NOT NULL,
   CREATED_ON DATETIME NOT NULL,
   UPDATED_BY BIGINT NOT NULL,
   UPDATED_ON DATETIME NOT NULL,
   DSA_UPDATABLE VARCHAR(2),
   CONSTRAINT PK_REF_DATA_ITEM_MASTER PRIMARY KEY (CATEGORY_ID, ITEM_ID)
);

CREATE TABLE POSTING
(	TC_ID BIGINT NOT NULL,
  INDIVIDUAL_ID BIGINT,
  START_DATE DATETIME NOT NULL,
  END_DATE DATETIME,
  CURRENT_FLOAT_IND TINYINT NOT NULL,
  CREATED_BY BIGINT NOT NULL,
  CREATED_ON DATETIME NOT NULL,
  UPDATED_BY BIGINT NOT NULL,
  UPDATED_ON DATETIME NOT NULL,
  CONSTRAINT PO_TI_II_WD_PK PRIMARY KEY (TC_ID, INDIVIDUAL_ID, START_DATE)
);

CREATE TABLE TEST_CENTRE
(	 TC_ID BIGINT NOT NULL,
   TC_COST_CENTRE_CODE VARCHAR(6) NOT NULL,
   OPENING_TIME DATETIME,
   CLOSING_TIME DATETIME,
   COMMISSION_DATE DATETIME NOT NULL,
   DECOMMISSION_DATE DATETIME,
   TC_TYPE_CODE TINYINT NOT NULL,
   MAIN_TEST_CENTRE_ID BIGINT,
   EXAMINER_CAPACITY_COUNT SMALLINT,
   TEST_ROUTE_CAPACITY_COUNT SMALLINT,
   WAITING_ROOM_CAPACITY_COUNT SMALLINT,
   FWD_PROGRAM_CREATE_WEEKS SMALLINT,
   DIRECTION_TEXT VARCHAR(255),
   BAD_WEATHER_INSTR_TEXT VARCHAR(255),
   MALE_WC_COUNT SMALLINT,
   FEMALE_WC_COUNT SMALLINT,
   MALE_STAFF_WC_COUNT SMALLINT,
   FEMALE_STAFF_WC_COUNT SMALLINT,
   PARKING_CAPACITY_COUNT SMALLINT,
   RESERVE_PROGRAM_COUNT SMALLINT,
   OPEN_RESERVE_PROGRAM_DAYS SMALLINT,
   TC_PROG_PERIOD_END_DATE DATETIME,
   PLANNED_MGMT_SLOT_COUNT SMALLINT,
   SPECIAL_MESSAGE_TEXT VARCHAR(255),
   MAX_REMOTE_WAIT_WEEKS SMALLINT,
   MIN_REMOTE_TEST_COUNT SMALLINT,
   REMOTE_TC_LAST_OPEN_DATE DATETIME,
   DEPLOY_CREATED_TO_DATE DATETIME,
   COUNTRY_ID BIGINT NOT NULL,
   SECTOR_ID BIGINT NOT NULL,
   INDIVIDUAL_ID BIGINT,
   TEST_CATEGORY_REF VARCHAR(10),
   AUTOFILL_IND TINYINT DEFAULT 0 NOT NULL,
   TB_DAY_OF_WEEK TINYINT DEFAULT 1 NOT NULL,
   SPECIAL_NEEDS_INFORMATION VARCHAR(255),
   LA_ID BIGINT,
   PWL_IND TINYINT DEFAULT 0 NOT NULL,
   UPDATED_ON DATETIME NOT NULL,
   CREATED_ON DATETIME NOT NULL,
   CREATED_BY BIGINT NOT NULL,
   UPDATED_BY BIGINT NOT NULL,
   UPDATE_FLAG TINYINT,
   SECURITY_COMPANY_ID BIGINT,
   BRANCH_PRINTER_ID BIGINT DEFAULT 0,
   TC_RESOURCE_PERIOD_END_DATE DATETIME,
   LAST_NOTIF_PRODUCED_DATE DATETIME,
   LAST_SCHEDULE_PRODUCED_DATE DATETIME,
   DISABLED_WC_COUNT SMALLINT,
   LATITUDE DECIMAL(10,8),
   LONGITUDE DECIMAL(11,8),
   CONSTRAINT TC_COST_CENTRE_CODE_UQ UNIQUE (TC_COST_CENTRE_CODE),
   CONSTRAINT TC_TC_ID_PK PRIMARY KEY (TC_ID)
);

CREATE TABLE TEST_CENTRE_NAME
(	TC_ID BIGINT NOT NULL,
  TC_NAME VARCHAR(50) NOT NULL,
  DISPLAY_ORDER TINYINT NOT NULL,
  UPDATED_ON DATETIME NOT NULL,
  CREATED_ON DATETIME NOT NULL,
  CREATED_BY BIGINT NOT NULL,
  UPDATED_BY BIGINT NOT NULL,
	CONSTRAINT TCN_TC_NAME_UQ UNIQUE (TC_NAME),
	CONSTRAINT TCN_TC_ID_PK PRIMARY KEY (TC_ID, DISPLAY_ORDER)
);

CREATE TABLE EXAMINER_STATUS
(	INDIVIDUAL_ID BIGINT,
  START_DATE DATETIME NOT NULL,
  END_DATE DATETIME,
  EXAMINER_STATUS_TYPE_CODE VARCHAR(1) NOT NULL,
  CONTRACT_TYPE_CODE VARCHAR(2),
  AREA_ID BIGINT,
  CREATED_BY BIGINT NOT NULL,
  CREATED_ON DATETIME NOT NULL,
  UPDATED_BY BIGINT NOT NULL,
  UPDATED_ON DATETIME NOT NULL,
  CONSTRAINT ES_II_SD_PK PRIMARY KEY (INDIVIDUAL_ID, START_DATE)
);

CREATE TABLE PROGRAMME
(	INDIVIDUAL_ID BIGINT NOT NULL,
  PROGRAMME_DATE DATETIME NOT NULL,
  TC_ID BIGINT NOT NULL,
  CHANGE_IND TINYINT NOT NULL,
  STATE_CODE INT NOT NULL,
  MODIFICATION_SEQ_NUMBER BIGINT,
  CONSTRAINT PRO_II_PD_TI_PK PRIMARY KEY (INDIVIDUAL_ID, PROGRAMME_DATE, TC_ID)
);

CREATE TABLE PROGRAMME_SLOT
(	SLOT_ID BIGINT NOT NULL,
  START_TIME DATETIME NOT NULL,
  MINUTES SMALLINT NOT NULL,
  STATE_CODE INT NOT NULL,
  GHOST_IND TINYINT NOT NULL,
  SLOT_TYPE_CODE TINYINT NOT NULL,
  VST_CODE BIGINT,
  NON_TEST_ACTIVITY_CODE VARCHAR(4),
  INDIVIDUAL_ID BIGINT NOT NULL,
  PROGRAMME_DATE DATETIME NOT NULL,
  TC_ID BIGINT NOT NULL,
  DEPLOYED_TO_FROM_CODE TINYINT,
  DEPLOYED_TO_FROM_TC_COST_CODE VARCHAR(6),
  CLOSURE_CODE INT,
  REPEATED_CLOSURE_CODE INT,
  SUSPENDED_IND TINYINT NOT NULL,
  DEPLOYMENT_ID BIGINT,
  TC_CLOSED_IND TINYINT NOT NULL,
  INSTRUCTOR_ID BIGINT,
  RESERVED_USER_NAME VARCHAR(50),
  RESERVED_DATE_TIME DATETIME,
  CANCELLED_DEPLOYMENT_IND TINYINT,
  MODIFICATION_SEQ_NUMBER BIGINT DEFAULT 1 NOT NULL,
	CONSTRAINT PS_SLOT_ID_PK PRIMARY KEY (SLOT_ID)
);

CREATE TABLE BOOKING
(	BOOKING_ID BIGINT NOT NULL,
	APP_ID BIGINT NOT NULL,
	ACTUAL_TEST_FEE_AMOUNT DECIMAL(5,2) NOT NULL,
	BOOKED_DATE DATETIME,
	BOOKING_CANCEL_REASON_CODE INT,
	CANCELLED_DATE_TIME DATETIME,
	CANCELLED_TC_ID BIGINT,
	LOST_FEE_IND TINYINT,
	NO_CANCEL_ACCEPT_IND TINYINT NOT NULL,
	NON_COMPLETION_CODE INT,
	RETEST_REFUND_IND TINYINT NOT NULL,
	STATE_CODE INT NOT NULL,
	TEST_SERVICE_ITEM_ID BIGINT NOT NULL,
	INCOME_ACCRUED_IND TINYINT,
	SLOT_ID BIGINT,
	FULL_TEST_FEE_AMOUNT DECIMAL(10,2),
	EXPECTED_TEST_FEE_AMOUNT DECIMAL(10,2),
	ACCRUED_FIN_TRAN_ID BIGINT,
	CREATED_BY BIGINT NOT NULL,
	CREATED_ON DATETIME NOT NULL,
	UPDATED_BY BIGINT NOT NULL,
	UPDATED_ON DATETIME NOT NULL,
	RESOURCE_SLOT_ID BIGINT,
	CONSTRAINT BO_AI_BSN_PK PRIMARY KEY (BOOKING_ID),
	CONSTRAINT BKG_SLOT_ID_UNIQUE UNIQUE (SLOT_ID)
);
